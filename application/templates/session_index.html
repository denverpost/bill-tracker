{% extends "base.html" %}
{% block style %}{% endblock style %}
{% block breadcrumbs %}{{ super() }}
&rsaquo; <a href="http://www.denverpost.com/bill-tracker">Bill Tracker</a>{% endblock breadcrumbs %}
{% block head %}
<!-- DATATABLES -->
<link rel="stylesheet" type="text/css" href="{{response.app.url_root}}static/css/datatables.css"/>
<link href="https://cdn.datatables.net/responsive/2.0.1/css/responsive.dataTables.min.css" rel="stylesheet" type="text/css"/>
<script src="https://cdn.datatables.net/r/zf-5.5.2/jqc-1.11.3,dt-1.10.8/datatables.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.0.1/js/dataTables.responsive.js"></script>
<script src="http://extras.denverpost.com/summercamps/2016/ColumnFilterWidgets.js"></script>
<style>
.widget-2 {
    width: 20%;
    float: left;
    margin-right: 20px;
}
.widget-3 {
    width: 30%;
    float: left;
}
</style>
{% endblock head %}
{% block content %}
<p>We're tracking bills in the Colorado General Assembly for these sessions:</p>
<ul>
{% for item in response.app.sessions|reverse %}
    <li><a href="{{item}}/">{{item}}</a></li>
{%- endfor %}
</ul>

<h2 id="search">Search Legislation, 2011-2016</h2>
<div class="row">
    <div class="large-12 columns">
        <table id="bill-table" class="stripe table-bordered">
            <thead>
                <tr>
					<th class="all">Title</th>
					<th class="all">Session</th>
				</tr>
            </thead>
            <tfoot>
            </tfoot>
        </table>
    </div>
</div>

<script>
var data = {{response.json|safe}};

$('#bill-table').dataTable( { 
    data: data,
    order: [ 0, "asc" ],
    paging: true,
    pagingType: 'numbers',
    pageLength: 50,
    responsive: true,
    columns: [ 
        { "data": "title",
          "render": function(data, type, full) {
              return "<a href='" + full['url'] + "'>" + data + "</a>";
          }
        },
        { "data": "session" }
	],
    autoWidth: false,
    //deferRender: true,
    dom: '<"top">Wf<"clear">tip',
    // https://github.com/cyberhobo/ColumnFilterWidgets
    oColumnFilterWidgets: {
        aiExclude: [0,1],
        // sSeparator: ',  ',
        bGroupTerms: false,
    }
} );

</script>

<div id="hide" style="display:none;">
</div>

<h2 id="generator">Fake Bill Title Generator</h2>
<script>
var markov = {
    titles: data,
    terminals: {},
    startwords: [],
    wordstats: {},
    init: function() {
        var len = this.titles.length;
        for (var i = 0; i < len; i++)
        {
            var words = this.titles[i]['title'].split(' ');
            this.terminals[words[words.length-1]] = true;
            this.startwords.push(words[0]);
            var wordlen = words.length;
            for (var j = 0; j < wordlen - 1; j++)
            {
                if (this.wordstats.hasOwnProperty(words[j])) {
                    this.wordstats[words[j]].push(words[j+1]);
                } else {
                    this.wordstats[words[j]] = [words[j+1]];
                }
            }
        }
    },
    choice: function (a) {
        var i = Math.floor(a.length * Math.random());
        return a[i];
    },
    make_title: function (min_length) {
        var word = this.choice(this.startwords);
        var title = [word];
        while (this.wordstats.hasOwnProperty(word)) {
            var next_words = this.wordstats[word];
            word = this.choice(next_words);
            title.push(word);
            if (title.length > min_length && this.terminals.hasOwnProperty(word)) break;
        }
        if (title.length < min_length) return this.make_title(min_length);
        return title.join(' ');
    }
}
markov.init()
</script>

{% endblock content %}
